## 4 剪辑与编排

### 4.1 分镜编排成片，用户可直接预览视频

- **入口/触发**
  - 在生成素材管理页面，用户点击【生成视频】进入剪辑与编排页面
  - 进入时默认加载"当前素材包的最终采用版本"（角色/场景/风格/分镜文本等以素材包沉淀结果为准）
- **自动生成可播放的视频草稿**
  - 系统基于分镜列表（文字）自动构建一条"成片草稿时间轴"（图片版）：
    - 每个分镜对应一个片段（Clip）
    - 默认时长：每个分镜 5s（可在后续调整）
    - 默认顺序：按分镜剧本顺序排列
  - 系统在页面主预览区提供"整片预览"，用户可一键播放查看节奏与连贯性
  - 用户无需理解生成过程细节，只需看到：**已自动生成一个可以播放的初稿（每一个片段实际上仍然是分镜画面）**
- **时间轴展示（可切换视图）**
  - 页面底部为时间轴区域，按时间顺序展示分镜片段缩略（图片/视频封面）：
    - 每个片段展示：分镜编号/缩略图/时长标记（例如 5s）
    - 当前播放位置以播放头（Playhead）显示
  - 时间轴支持长视频横向滚动（无需分页），保证用户可连续浏览所有分镜
  - 支持点击任一分镜片段：
    - 主预览区跳转并聚焦到该分镜（分镜画面（主预览区）/文本信息（左栏编辑栏）同步切换）
    - 时间轴高亮该片段，形成明确的"当前位置"感
  - 在时间轴区域支持两种查看方式，两种视图共享同一套选中状态与播放定位，避免用户迷路
    - **时间轴视图**：适合节奏与时长调整
    - **故事面板视图**：以卡片/格子并排查看每个分镜，适合快速检查叙事连贯与画面一致性
  - 每个分镜片段在时间轴上有清晰的形态标识：
    - 当前片段来源：图片片段 / 视频片段，以小图标区分
- **主预览区**
  - 主预览区默认展示"整片预览"，按时间轴顺序播放
  - 当用户选中某个分镜：
    - 左栏显示当前分镜的关键信息：分镜的内容，生图prompt
    - 主预览区有对分镜的视频片段单独播放的按钮
- **异常与兜底**
  - 若某些分镜片段暂未生成成功：
    - 该分镜以占位缩略显示并标记"待生成"
    - 不阻断用户预览已生成部分

### 4.2 分镜图生视频，支持用户选择模型

- **触发场景**
  - 针对单个分镜片段，用户对单个分镜图片，在左栏触发`生成视频`
  - 针对全片，用户直接点击右上角`一键生成视频`按钮，对未单独生成视频的分镜，一起生成视频
  - 模型选择仅在点击`生成视频`和`一键生成视频`时以弹窗的方式出现，不打扰用户浏览时间轴与基础剪辑操作
- **模型选择**
  - 窗中以轻量浮层/抽屉展示可选模型列表：
    - 每个模型卡片展示：
      - 模型名称
      - 适用标签
      - 预计消耗（额度/积分）
- **视频的候选并存与对比**
  - 每次生成的视频，作为该分镜的**新视频候选**并存展示，不覆盖旧候选；在主预览区的主画面右侧以缩略图的形式展示，点击切换；点击某候选卡 → 显示✅"当前使用"
  - 当前使用的候选会同步体现在时间轴该分镜片段上（封面/标记更新）
- **成本/额度提示**
  - 在用户点击`生成视频`时展示预计消耗：
    - "本次生成将消耗 X 积分或额度"
    - 余额不足时阻断并提供可操作路径（充值/购买会员）

### 4.3 分镜画面修改，用户在左栏提意见并重新生成/选择生成视频

- **对象范围**
  - **分镜图片**：用于分镜的静帧画面，可作为生成视频的基础
  - **分镜视频**：用于该分镜在成片中的动态片段，可由图片生成视频产生

- **入口/触发**
  - 用户在时间轴/故事面板选中某个分镜后，在主预览区显示分镜画面或视频：
    - 左栏显示生成分镜画面提示词，用户可修改或提意见，点击`重生成`，满意后点击`生成视频`
    - 视频同理，显示生成视频提示词，用户可修改或提意见，`重生成`，不满意可以`重新生成`
  - 在左栏生成的多个图片和视频，右上角提供一个按钮`应用`，用户点击来确定该分镜对应的画面和视频；如未点击，则默认应用最新生成的分镜画面或视频
  - 多个图片和视频，在主预览区的右侧，以缩略图的方式上下翻动切换，画面和视频各一栏（待定）

### 4.4 分镜画面编辑，裁剪、片段长度、画面形态

- **操作对象与范围**
  - 最小编辑单元为"分镜片段 Clip"
  - 用户在时间轴/故事面板点击某个分镜片段 → 主预览区展示画面 → 画面上方显示画布编辑
- **片段长度调整**
  - 每个分镜片段有默认时长（如 5s），用户可在时间轴上直接调整该片段长度：
    - 拖拽片段左右边界改变时长（可视化显示时长数值）
    - 支持吸附到常用档位
  - 调整时长后：
    - 片段长度在时间轴上实时变化
    - 主预览区播放该分镜时按新时长生效
  - 与旁白的关系：
    - 若当前分镜旁白时长明显超过片段时长，给予轻提示："旁白可能播放不完整，建议延长片段或精简台词"
- **画面形态切换（图片/ 视频）**
  - 同一分镜片段支持两种表现形态：
    - **图片片段**：静帧 + 时长
    - **视频片段**：该分镜对应的视频候选
  - 用户可在分镜详情区一键切换当前采用形态：
    - 若尚无视频候选，切换到视频形态时引导【生成视频】
  - 当前采用形态会同步反映在时间轴缩略上（例如小图标标识"图/视频"）

> 这里还在考虑是否支持调整画面形态，还是只输出视频呢？

- **异常与兜底**
  - 调整时长的异常（如过短/过长）：
    - 给出限制提示（例如"最短 1s / 最长 15s"

### 4.5 分镜音频处理，旁白、对话和BGM

- **音频结构**
  - **分镜级**：旁白/台词（TTS 生成，随分镜走），旁白全片统一音色，对话全片保持角色音色一致；
  - **全片级**：BGM（一首或一条主背景音乐，覆盖全片）
- **入口/触发**
  - 用户在时间轴选中某个分镜片段 → 在左栏点击`配音`和`音乐`配置。

#### 4.5.1 `配音`：包含旁白和对话：

- **旁白配置**
  - **旁白文本编辑**
    - 用户选定分镜时，左栏点击进入配音即可见：当前旁白，支持直接编辑
    - 提供字数/时长的实时反馈：一秒钟4个字
    - 支持用户上传自定义配音音频，此时是否需要添加语音识别？
  - **音色选择**
    - 默认系统为该分镜推荐一个音色
    - 用户可通过【换音色】入口切换：
      - 推荐列表：系统给若干可选项
      - 音色与 BGM 均支持从"资产库的音色库"中选择，形成资产复用
    - 音色以"名称 + 喇叭试听"呈现，试听不打断主预览，固定朗读内容
  - **轻量参数调节**
    - 语速（滑杆）
    - 音量（滑杆）
    - 情绪（限定枚举：平静/开心/严肃等）
  - **应用方式**
    - 用户在当前面板内完成编辑后，点击`应用修改`才更新该分镜的旁白音频
    - 应用后主预览区可立即试听当前分镜效果：同时播放分镜画面和旁白
  - **旁白的边界提示**
    - 当旁白预估时长明显超过当前分镜片段时长：
      - 给出轻提示："旁白可能播放不完整，建议延长分镜或精简台词"
      - 不强制阻断用户继续编辑
    - 用户可自行选择：去调整分镜时长或精简旁白文本

#### 4.5.2 音乐：BGM

- **默认生成**
  - 系统在首次生成成片草稿时可默认配一条 BGM
  - 用户可在"背景音乐"入口进行替换/调整
- **两种来源路径**
  - **AI 生成 BGM**
    1. 展示"生成提示词"，用户可自行编辑提示词并`重新生成`，也可以不修改直接`重新生成`
    2. 消耗额度，在触发前展示预计消耗并在不足时提示充钱
  - **用户自定义 BGM**
    1. 从"资产库> 音乐库"选择
    2. 或本地上传音频文件（限制音频文件格式为`.mp4`、`.wav`）
- **试听与应用**
  - 选择任一 BGM 后可立即试听
  - 点击【应用】后替换整片 BGM

## 