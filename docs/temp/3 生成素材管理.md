## 3 生成素材管理

承接系统生成的中间素材结果，提供统一的查看、预览、筛选、对比与选择，形成可用于成片的"素材集合"。

### 3.1 左栏-任务拆解与进度反馈

- **对话触发**
  - 用户在「输入与素材导入」完成提交后，自动进入"生成素材管理"页面并开始生成流程
  - 用户在当前素材包内发起"重新生成/修改后生成"时，同样触发该流程；系统在左栏"用户和系统对话框"内显示
- **任务拆解呈现（To-do / 步骤清单）**
  - 页面以固定的步骤清单呈现本次生成的结构化任务（与中间栏的 5 类素材一一对应），默认包含：
    - 构建短片的核心故事线和情节
    - 定义整体视觉风格和美术细节
    - 设计短片中登场的角色形象
    - 规划短片中的场景布局和元素
    - 绘制详细的分镜图和镜头描述
  - 支持步骤折叠/展开（默认展开），便于用户快速扫一眼进度
  - 每一步可点击跳转至中间栏对应内容位置（若该步已产生可展示内容）
- **进度状态反馈（用户可见）**
  - 每一步显示清晰的状态标记（不暴露技术细节）：
    - 未开始：灰色/空心状态
    - 进行中：加载态（转圈/进度动效）
    - 已完成：绿色对勾
  - 整体进度在步骤清单顶部提供一句话概览（可选）：
    - "正在生成第 X/5 步：……"
- **实时流式输出**
  - 某一步完成后，中间栏对应模块自动出现/更新内容
  - 用户在等待过程中可以先浏览已完成的模块内容；未完成模块展示占位骨架屏/提示"生成中"
- **失败与可恢复路径（只写用户可见）**
  - 若某一步生成失败：
    - 该步标记为"失败"并展示可操作提示（不暴露失败原因细节）
    - 提供【重试本步】的明确入口（优先）
    - 同时保留【跳过本步继续】
  - 若整体生成失败/中断：
    - 页面提示"本次生成未完成"，并给出【一键重试】入口
    - 已完成步骤的结果保留可见（不清空），避免用户"白等"
  - 网络/超时类问题：
    - 统一提示"网络异常/生成超时，请重试"，提供重试按钮

### 3.2 左栏阶段性成果展示-素材包沉淀与切换

- **素材包定义**
  - 素材包 = 用户在"生成素材管理"阶段得到的一份**阶段性可用结果快照**，包含本轮生成后的结构化素材集合（故事梗概/美术风格/角色/场景/分镜等），包括右栏对素材包内素材进行元素级微调的版本结果，以及系统对本轮修改意图的总结
- **入口/触发**
  - **首次进入生成素材管理页面并完成一轮生成**后，自动生成 1 个素材包（作为初始版本）
  - 后续在同一创作中，用户进行多次局部修改/重生成时：
    - 修改默认作用于"当前素材包的工作态"（不立即生成新素材包）
    - 当用户点击【保存为新版本】或在关键节点触发"阶段性确认"（如【进入剪辑/生成视频】前的确认）时，生成新的素材包
  - 用户可继续在最新素材包基础上迭代，形成包序列
- **素材包命名与列表呈现**
  - 素材包在左侧"创作过程/版本"区域以对话形式呈现在对话框中，按照时间倒序，最新生成的在最下方
  - 每个素材包展示最小必要信息：
    - 自动生成的简短名称（默认：从本轮主题/故事核心词抽取）
    - 生成时间
  - 支持用户对素材包重命名
- **切换与生效规则**
  - 点击某个素材包即切换当前工作区到该素材包：
    - 中间栏展示该素材包对应的结构化素材内容
    - 右侧修改面板的"当前选中对象"上下文切换到该素材包
  - 切换素材包后，用户的后续修改默认基于"当前选中的素材包"进行
- **素材包内容边界**
  - **包含：**
    - 结构化中间素材：故事梗概、美术风格、角色列表（默认选择为上次查看的最终版本）、场景列表（同上）、分镜剧本等
    - 与该素材包关联的"系统总结"（对本轮主要修改点的概括，用于左栏叙事记录）
    - 每一次右栏元素级微调产生的素材版本历史
- **候选与"最终采用"的沉淀规则**
  - 对于同一对象（如某个角色形象图/某个场景图/某个音色）：
    - 编辑过程中允许多个候选并存供对比查看
    - 素材包沉淀时保留历史版本（默认以用户最后查看/显式点击为准）
  - 素材包沉淀后的内容用于后续剪辑与编排阶段的生成与引用
- **生成素材包前的"阶段性总结"**
  - 用户在中间栏/右栏完成多次局部元素级修改后，系统在生成新素材包时自动生成一条"本轮变更摘要"：
    - 以用户可读的语言概括本轮主要修改（不逐条罗列微操作）
    - 作为左栏"创作过程记录"的一条条目
- **未完成/中断场景**
  - 若用户在生成过程中离开或中断：
    - 在素材包列表中保留一个"未完成"状态的条目（灰态 + 标识）
    - 用户返回后可在左栏对话框，点击继续生成/重试
    - 未完成素材包不进入"可用于剪辑"的默认选择（可提示用户先完成生成）

### 3.3 中间栏-素材结构化展示与候选并存（文本 / 图像 / 音色）

- **展示结构**
  - 中间栏按固定小标题分段展示，包含：
    - 故事梗概（文本）
    - 美术风格（文本 + 风格参考图如有）
    - 主体列表（角色：图片 + 文本描述 + 音色）
    - 场景列表（场景：图片 + 文本描述）
    - 分镜剧本（文本为主，可附分镜参考图/镜头示意如有）
  - 中栏侧边提供小标题锚点，点击跳转到对应分段；滚动时高亮当前所在分段
  - 每个分段在未生成完成时展示骨架屏/占位提示"生成中"，完成后自动回填内容
- **数据对象与承载方式**
  - 文本类对象：故事梗概段落、美术风格描述、分镜条目（镜头描述/旁白台词/动作等）
  - 图像类对象：角色形象图（如三视图/主视图）、场景图、风格参考图（如有）
  - 音色类对象：角色音色、旁白音色（以名称 + 喇叭试听为主）
  - 列表结构：角色列表/场景列表/分镜列表均为可展开的条目集合，用户能明确"有多少个、每个是什么"
- **候选并存机制**
  - 对于可重生成的对象（角色图/场景图/音色推荐/关键文本段落）：
    - 每次右栏微调后，重新生成产生"新候选"，**不覆盖旧候选**
    - 同一对象下候选以横向卡片/轮播形式并排展示，便于对比
    - 候选展示最小信息：缩略图/片段预览 + 生成时间（或"新/上一版"轻标签）
  - 候选数量控制（避免无限堆积）：
    - 默认只展示最近 4个候选，超出后折叠为"更多…"
    - 允许用户手动删除某个候选（可选，可先不做删除，只做折叠）
- **"选择即生效"的采用规则**
  - 用户不需要额外点击"确认采用"
  - 采用规则为**显式采用**：用户点击候选卡片 → 出现✅"已选中"标签（推荐，更确定）
  - 当前采用的候选在该对象区域内始终可见，并在进入下一阶段（剪辑与编排阶段）时作为默认输入

- **候选对比与预览**
  - 图片候选：
    - 默认缩略图展示，点击放大预览
    - hover可展开"生成描述提示词"（只读），便于理解差异（不要求用户编辑prompt），用户点击后可以在右栏进行图像编辑。
  - 音色候选：
    - 以"名称 + 喇叭试听"展示；点击试听播放示例
    - 支持"换一换/切换"生成或推荐新候选（若支持），同样进入候选并存
  - 文本候选（如关键段落/分镜条目）：
    - 以段落卡片形式展示候选
- **与"资产库"的联动**
  - 角色/场景/音色条目提供"从资产库选择替换"的入口（如按钮/下拉）
  - 从资产库替换后作为"新候选"加入候选区（同样遵循不覆盖规则）

### 3.4 右栏-元素级修改与微调

- **能力定位**
  - 用户不需要"重写整段 prompt"或"对整个素材包提一条笼统意见"，而是可以**直接对某一个具体对象提出修改**（一段文字 / 一张图片 / 一个音色条目等）
  - 系统负责把用户的修改意图转化为可执行的重生成，并在必要时自动联动更新相关内容；**不要求用户判断影响范围**、不让用户做"范围选择"
- **可被选中并修改的对象范围**
  - **文本对象**：故事梗概段落、美术风格描述片段、角色/场景的文字设定字段、分镜条目（镜头描述/旁白台词/动作等）
  - **图像对象**：角色形象图（主视图/三视图）、场景图
  - **音色对象**：角色音色、旁白音色（以"试听 + 切换"为主，不做音色重生成）
  - 说明：BGM 属于剪辑与编排阶段处理；本模块只处理"角色/旁白音色"的选择与替换
- **交互总原则**
  - **中间栏负责"选中对象"**：用户在结构化素材展示中点击/框选某个对象
  - **右栏负责"提出修改 + 触发重生成"**：右栏始终围绕"当前选中对象"展开，不出现复杂配置表
  - **结果以候选并存呈现**：每次修改产生新候选，不覆盖旧结果，用户可回看并回选（与"候选并存/选择即生效"规则一致）
  - **系统承担联动复杂性**：若某次修改会引起后续素材调整，系统自动处理并通过简洁方式告知结果（不让用户决策范围）
  - - 其实没想好怎么联动后续素材调整。
- **入口/触发**
  - **文本**：在中间栏对某段文字进行框选/点击段落卡片 → 进入右栏编辑，支持两种方式：一种是点击在右栏出现的"段落卡片"，直接编辑并点击"保存"；另一种是在输入框"提交修改意见"，提交后重新生成；
  - **图片**：点击缩略图/候选卡片 → 进入右栏"改图"面板（支持查看生成描述/提示词），对图片的编辑实际上就是对生图的提示词的编辑，同文本编辑。
  - **音色**：点击喇叭试听区域或"换一换"入口 → 在右栏打开音色切换（从资产库中选择，系统默认提供几种音色）
- **右栏内容结构**
  - 右栏只包含三块信息（避免复杂面板）：
    - **当前对象展示**：显示被选中的文本片段/图片大图/音色名称（+试听按钮）；如果是图片，将图片与生图提示词分开展示；
    - **修改输入区**：一个主输入框（占位符统一："请输入你的修改意见，例如：更成熟/更写实/换成夜景/语气更轻松"）
    - **操作按钮**：
      1. 文本/图片：
         - 文本 → 【保存】
         - 生图提示词 → 【保存并重新生成】
         - 文本、图片（也就是生图提示词） → 【提交修改意见】
      2. 音色：默认【换一个音色】+ 可选【从资产库中选择】
- **系统自动联动的呈现方式**
  - 当用户修改某对象后，系统可能自动更新相关模块内容（例如改角色→分镜台词/镜头描述同步变化）；若某对象被后续模块引用（例如角色形象影响分镜描述/镜头提示），系统以"当前采用版本"为唯一输入来源
    - 典型场景：
      - 修改故事梗概的一句话 → 系统可能同步修正后续分镜中的对应设定（自动完成）
      - 修改某个角色性格描述 → 系统可能同步调整该角色在分镜中的台词风格（自动完成）
    - 对用户的呈现方式：以"结果变化"体现联动，而不是让用户先做范围决策
  - 用户侧的反馈方式建议使用"轻量可解释"而非决策：
    - 在本次修改完成后给一条提示："已根据你的修改同步更新XXX"或"已更新：角色设定、分镜剧本（2处）"→ 此处是否可以是类似于"拍一拍"那种灰色的偷偷的显示在左栏？展示微操作
  - 用户无需确认范围；若用户不满意，可继续基于新结果再次局部修改（产生新候选）
  - 若当前采用候选被删除/不可用（若支持删除）：自动回退到最近一次可用候选，并提示"已为你切换到可用版本"
  - 当候选被采用时，提供轻量反馈（不弹窗打断）：
    - 候选卡片出现✅标记
    - 在对象标题右侧显示"当前使用：xxx"（可选）
  - 若用户在不同候选间切换，✅标记随之移动，始终只有一个候选被标记为"当前使用"
- **与素材包的关系（避免版本爆炸）**
  - 多次元素级修改不会自动生成新素材包
  - 当用户点击【保存为新版本】或进入下一阶段（剪辑与编排）触发阶段性确认时：
    - 系统将当前采用的对象集合沉淀为新的素材包
    - 同时在左栏生成一条"本轮修改摘要"（总结主要修改意图，不列微操作）
- **异常与兜底（合并写法，只保留用户可见）**
  - 生成失败：在对象候选区提示"生成失败，请重试"，提供【重试】按钮
  - 结果不可用/不满意：用户可继续输入修改意见再次生成候选（不要求回退/撤销）
  - 资源/额度不足（若该步计费）：提示"余额不足，无法生成"，给出充值/购买入口（若本阶段不计费则不出现）

## 